{%- comment -%}
  Enhanced Language Switcher Component
  
  Parameters:
  - enable_language_selector: boolean (default: false)
  - enable_country_selector: boolean (default: false)
  - show_border: boolean (default: true) 
  - button_size: string (default: 'normal') - 'small', 'normal', 'large'
  - margin_bottom: string (default: '0')
{%- endcomment -%}

{%- liquid
  assign enable_language_selector = enable_language_selector | default: false
  assign enable_country_selector = enable_country_selector | default: false
  assign show_border = show_border | default: true
  assign button_size = button_size | default: 'normal'
  assign margin_bottom = margin_bottom | default: '0'
  assign css_scope = css_scope | default: 'global'
-%}

<style>
  .{{ css_scope }}-language-switcher .language-switcher-flag .flag-icon {
    width: 20px;
    height: 15px;
    border-radius: 2px;
    display: inline-block;
    vertical-align: middle;
  }

  .{{ css_scope }}-language-switcher .language-switcher-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    background: transparent;
    {% if show_border %}
    border: 1px solid rgba(255, 255, 255, 0.2);
    {% else %}
    border: none;
    {% endif %}
    border-radius: 6px;
    color: inherit;
    cursor: pointer;
    transition: all 0.2s ease;
    
    {% case button_size %}
      {% when 'small' %}
        padding: 4px 6px;
        font-size: 12px;
      {% when 'large' %}
        padding: 8px 12px;
        font-size: 16px;
      {% else %}
        padding: 6px 10px;
        font-size: 14px;
    {% endcase %}
  }

  .{{ css_scope }}-language-switcher .language-switcher-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    {% if show_border %}
    border-color: rgba(255, 255, 255, 0.3);
    {% endif %}
  }

  .{{ css_scope }}-language-switcher .language-switcher-flag {
    {% case button_size %}
      {% when 'small' %}
        font-size: 14px;
      {% when 'large' %}
        font-size: 18px;
      {% else %}
        font-size: 16px;
    {% endcase %}
    line-height: 1;
  }

  .{{ css_scope }}-language-switcher .language-switcher-text {
    font-weight: 500;
    {% case button_size %}
      {% when 'small' %}
        font-size: 10px;
      {% when 'large' %}
        font-size: 14px;
      {% else %}
        font-size: 12px;
    {% endcase %}
  }

  .{{ css_scope }}-language-switcher .language-switcher-arrow {
    opacity: 0.7;
    transition: transform 0.2s ease;
  }

  .{{ css_scope }}-language-switcher .language-switcher-btn:hover .language-switcher-arrow {
    transform: translateY(1px);
  }

  .{{ css_scope }}-language-switcher.header-localization {
    margin-bottom: {{ margin_bottom }};
  }

  @media (max-width: 768px) {
    .{{ css_scope }}-language-switcher .language-switcher-btn {
      padding: 4px 8px;
      font-size: 12px;
    }
    
    .{{ css_scope }}-language-switcher .language-switcher-flag {
      font-size: 14px;
    }
    
    .{{ css_scope }}-language-switcher .language-switcher-text {
      font-size: 10px;
    }
  }
</style>

{% if enable_language_selector or enable_country_selector %}
  <div class="{{ css_scope }}-language-switcher header-localization">
    <!-- Enhanced Language Switcher Button -->
    <button class="language-switcher-btn" onclick="document.getElementById('language-popup').classList.remove('hidden')" aria-label="Change language and location">
      <span class="language-switcher-flag">
        {% case request.locale.iso_code %}
          {% when 'de' %}
            {% if request.locale.root_url contains '/de-at' %}
              <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
                <rect width="640" height="160" fill="#c8102e"/>
                <rect y="160" width="640" height="160" fill="#fff"/>
                <rect y="320" width="640" height="160" fill="#c8102e"/>
              </svg>
            {% else %}
              <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
                <rect width="640" height="160" fill="#000"/>
                <rect y="160" width="640" height="160" fill="#dd0000"/>
                <rect y="320" width="640" height="160" fill="#ffce00"/>
              </svg>
            {% endif %}
          {% when 'fr' %}
            <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
              <rect width="213.3" height="480" fill="#002654"/>
              <rect x="213.3" width="213.3" height="480" fill="#fff"/>
              <rect x="426.6" width="213.4" height="480" fill="#ce1126"/>
            </svg>
          {% when 'fi' %}
            <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
              <rect width="640" height="480" fill="#fff"/>
              <rect y="175" width="640" height="130" fill="#003580"/>
              <rect x="175" width="130" height="480" fill="#003580"/>
            </svg>
          {% when 'en' %}
            {% if request.locale.root_url contains '/en-de' or request.locale.root_url == '/' %}
              <!-- 德国英语 -->
              <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
                <rect width="640" height="160" fill="#000"/>
                <rect y="160" width="640" height="160" fill="#dd0000"/>
                <rect y="320" width="640" height="160" fill="#ffce00"/>
              </svg>
            {% elsif request.locale.root_url contains '/en-fr' %}
              <!-- 法国英语 -->
              <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
                <rect width="213.3" height="480" fill="#002654"/>
                <rect x="213.3" width="213.3" height="480" fill="#fff"/>
                <rect x="426.6" width="213.4" height="480" fill="#ce1126"/>
              </svg>
            {% elsif request.locale.root_url contains '/en-at' %}
              <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
                <rect width="640" height="160" fill="#c8102e"/>
                <rect y="160" width="640" height="160" fill="#fff"/>
                <rect y="320" width="640" height="160" fill="#c8102e"/>
              </svg>
            {% elsif request.locale.root_url contains '/en-fi' %}
              <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
                <rect width="640" height="480" fill="#fff"/>
                <rect y="175" width="640" height="130" fill="#003580"/>
                <rect x="175" width="130" height="480" fill="#003580"/>
              </svg>
            {% else %}
              <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
                <defs>
                  <radialGradient id="earthGradDefault" cx="50%" cy="30%" r="70%">
                    <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                    <stop offset="70%" style="stop-color:#4682B4;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#191970;stop-opacity:1" />
                  </radialGradient>
                </defs>
                <circle cx="320" cy="240" r="200" fill="url(#earthGradDefault)"/>
                <path d="M200 180 Q280 160 360 200 Q400 240 380 300 Q320 320 260 300 Q220 260 200 180" fill="#228B22" opacity="0.8"/>
                <path d="M380 160 Q440 180 460 220 Q450 260 420 240 Q400 200 380 160" fill="#32CD32" opacity="0.7"/>
                <path d="M160 280 Q200 300 240 340 Q220 380 180 360 Q140 320 160 280" fill="#228B22" opacity="0.8"/>
                <path d="M440 300 Q480 320 500 360 Q480 400 450 380 Q420 340 440 300" fill="#32CD32" opacity="0.7"/>
                <ellipse cx="280" cy="200" rx="40" ry="15" fill="white" opacity="0.3"/>
                <ellipse cx="380" cy="280" rx="35" ry="12" fill="white" opacity="0.3"/>
                <ellipse cx="240" cy="320" rx="30" ry="10" fill="white" opacity="0.2"/>
              </svg>
            {% endif %}
          {% else %}
            <svg class="flag-icon" viewBox="0 0 640 480" width="20" height="15">
              <defs>
                <radialGradient id="earthGradDefault2" cx="50%" cy="30%" r="70%">
                  <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                  <stop offset="70%" style="stop-color:#4682B4;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#191970;stop-opacity:1" />
                </radialGradient>
              </defs>
              <circle cx="320" cy="240" r="200" fill="url(#earthGradDefault2)"/>
              <path d="M200 180 Q280 160 360 200 Q400 240 380 300 Q320 320 260 300 Q220 260 200 180" fill="#228B22" opacity="0.8"/>
              <path d="M380 160 Q440 180 460 220 Q450 260 420 240 Q400 200 380 160" fill="#32CD32" opacity="0.7"/>
              <path d="M160 280 Q200 300 240 340 Q220 380 180 360 Q140 320 160 280" fill="#228B22" opacity="0.8"/>
              <path d="M440 300 Q480 320 500 360 Q480 400 450 380 Q420 340 440 300" fill="#32CD32" opacity="0.7"/>
              <ellipse cx="280" cy="200" rx="40" ry="15" fill="white" opacity="0.3"/>
              <ellipse cx="380" cy="280" rx="35" ry="12" fill="white" opacity="0.3"/>
              <ellipse cx="240" cy="320" rx="30" ry="10" fill="white" opacity="0.2"/>
            </svg>
        {% endcase %}
      </span>
      <span class="language-switcher-text">{{ request.locale.iso_code | upcase }}</span>
      <svg width="12" height="12" viewBox="0 0 24 24" class="language-switcher-arrow">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none"/>
      </svg>
    </button>
    
    <div style="display: none;">
      {% render 'localization-form', id: 'enhanced-localization', hide_labels: true, promote_popular: true %}
    </div>
  </div>
{% endif %}