{%- comment -%}
  Custom Marker Icon for Dealer Search
  Parameters:
  - store_type: dealer, rental, service, click-collect
  - size: small, medium, large (default: medium)
{%- endcomment -%}

{%- assign store_type = store_type | default: 'dealer' -%}
{%- assign size = size | default: 'medium' -%}

{%- case size -%}
  {%- when 'small' -%}
    {%- assign width = 32 -%}
    {%- assign height = 40 -%}
    {%- assign circle_center_y = 16 -%}
    {%- assign scale_factor = 0.018 -%}
  {%- when 'large' -%}
    {%- assign width = 44 -%}
    {%- assign height = 56 -%}
    {%- assign circle_center_y = 22 -%}
    {%- assign scale_factor = 0.025 -%}
  {%- else -%}
    {%- assign width = 40 -%}
    {%- assign height = 50 -%}
    {%- assign circle_center_y = 20 -%}
    {%- assign scale_factor = 0.023 -%}
{%- endcase -%}

{%- case store_type -%}
  {%- when 'dealer' -%}
    {%- assign primary_color = '#2563eb' -%}
    {%- assign secondary_color = '#1d4ed8' -%}
  {%- when 'rental' -%}
    {%- assign primary_color = '#059669' -%}
    {%- assign secondary_color = '#047857' -%}
  {%- when 'service' -%}
    {%- assign primary_color = '#dc2626' -%}
    {%- assign secondary_color = '#b91c1c' -%}
  {%- when 'click-collect' -%}
    {%- assign primary_color = '#7c3aed' -%}
    {%- assign secondary_color = '#6d28d9' -%}
  {%- else -%}
    {%- assign primary_color = '#2563eb' -%}
    {%- assign secondary_color = '#1d4ed8' -%}
{%- endcase -%}

<div class="custom-marker-wrapper custom-marker-wrapper--{{ store_type }}" style="width: {{ width }}px; height: {{ height }}px; position: relative; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3));">
  <svg width="{{ width }}" height="{{ height }}" viewBox="0 0 {{ width }} {{ height }}" fill="none" xmlns="http://www.w3.org/2000/svg" class="custom-marker custom-marker--{{ store_type }}" style="position: absolute; top: 0; left: 0;">
    <path d="M{{ width | divided_by: 2 }} {{ height | minus: 2 }}C{{ width | divided_by: 2 }} {{ height | minus: 2 }} {{ width | minus: 2 }} {{ circle_center_y | plus: 5 }} {{ width | minus: 2 }} {{ circle_center_y }}C{{ width | minus: 2 }} {{ circle_center_y | minus: 8 }} {{ width | divided_by: 2 | plus: 8 }} 2 {{ width | divided_by: 2 }} 2C{{ width | divided_by: 2 | minus: 8 }} 2 2 {{ circle_center_y | minus: 8 }} 2 {{ circle_center_y }}C2 {{ circle_center_y | plus: 5 }} {{ width | divided_by: 2 }} {{ height | minus: 2 }} {{ width | divided_by: 2 }} {{ height | minus: 2 }}Z" 
          fill="{{ primary_color }}" 
          stroke="#ffffff" 
          stroke-width="1"/>
    
    <circle cx="{{ width | divided_by: 2 }}" cy="{{ circle_center_y }}" r="{{ width | divided_by: 2 | minus: 5 }}" fill="rgba(255,255,255,0.2)"/>
    
    {% comment %} Hepha icon {% endcomment %}
    <g transform="translate({{ width | divided_by: 2 }}, {{ circle_center_y }}) scale({{ scale_factor }}) translate(-439, -466)">
      <path d="M812.803 390.655C811.283 388.196 807.846 387.804 805.784 389.828C770.081 425.234 506.872 686.252 506.809 686.314C469.336 723.476 408.575 723.476 371.101 686.314C333.628 649.153 333.628 588.897 371.101 551.736C371.101 551.736 482.73 441.14 553.531 370.989C590.005 334.84 610.522 285.801 610.522 234.675L610.585 4.47674C610.585 0.489988 605.731 -1.49306 602.899 1.31626L350.646 251.345C347.813 254.155 342.96 252.172 342.96 248.185V109.31C342.96 105.323 338.107 103.34 335.274 106.149L124.869 314.865H124.994C-43.3964 485.696 -41.6467 759.894 130.243 928.597C301.591 1096.72 580.027 1095.65 750.105 926.263C896.249 780.736 917.141 558.222 812.803 390.655Z" fill="#ffffff"/>
    </g>
  </svg>
  
  <!-- 渐变覆盖层 -->
  <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, {{ primary_color }}, {{ secondary_color }}); clip-path: path('M{{ width | divided_by: 2 }} {{ height | minus: 2 }}C{{ width | divided_by: 2 }} {{ height | minus: 2 }} {{ width | minus: 2 }} {{ circle_center_y | plus: 5 }} {{ width | minus: 2 }} {{ circle_center_y }}C{{ width | minus: 2 }} {{ circle_center_y | minus: 8 }} {{ width | divided_by: 2 | plus: 8 }} 2 {{ width | divided_by: 2 }} 2C{{ width | divided_by: 2 | minus: 8 }} 2 2 {{ circle_center_y | minus: 8 }} 2 {{ circle_center_y }}C2 {{ circle_center_y | plus: 5 }} {{ width | divided_by: 2 }} {{ height | minus: 2 }} {{ width | divided_by: 2 }} {{ height | minus: 2 }}Z'); pointer-events: none;"></div>
</div>