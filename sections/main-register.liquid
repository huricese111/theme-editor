<div class="container fully-spaced-row">
  <div class="small-form account-form" {%- render 'animation-attrs', attrs: 'data-cc-animate' -%}>
    <div id="customer">
      <!-- Create Customer -->
      <div id="create-customer">
        <div class="page-header">
          <h2 class="title">{{ 'customer.register.title' | t }}</h2>
        </div>
        {%- liquid
          assign lang = request.locale.iso_code
          case lang
            when 'de'
              assign email_hint_invalid = 'Ungültige E-Mail-Adresse'
              assign pwd_strength_weak = 'Schwach'
              assign pwd_strength_fair = 'Mittel'
              assign pwd_strength_strong = 'Stark'
              assign pwd_strength_very_strong = 'Sehr stark'
              assign pwd_hint_minlen = 'Mindestens 8 Zeichen erforderlich.'
            when 'fr'
              assign email_hint_invalid = 'Adresse e-mail invalide'
              assign pwd_strength_weak = 'Faible'
              assign pwd_strength_fair = 'Moyen'
              assign pwd_strength_strong = 'Fort'
              assign pwd_strength_very_strong = 'Très fort'
              assign pwd_hint_minlen = 'Au moins 8 caractères requis.'
            when 'fi'
              assign email_hint_invalid = 'Virheellinen sähköpostiosoite'
              assign pwd_strength_weak = 'Heikko'
              assign pwd_strength_fair = 'Kohtalainen'
              assign pwd_strength_strong = 'Vahva'
              assign pwd_strength_very_strong = 'Erittäin vahva'
              assign pwd_hint_minlen = 'Vähintään 8 merkkiä vaaditaan.'
            else
              assign email_hint_invalid = 'Not valid email'
              assign pwd_strength_weak = 'Weak'
              assign pwd_strength_fair = 'Fair'
              assign pwd_strength_strong = 'Strong'
              assign pwd_strength_very_strong = 'Very strong'
              assign pwd_hint_minlen = 'Must be at least 8 characters.'
          endcase
        -%}
        <div class="auth-card">
          {% form 'create_customer' %}
            {%- render 'form-errors', form: form -%}

            <div class="input-row md3-outlined">
              <label for="first_name" class="login">{{ 'customer.register.first_name' | t }}</label>
              <div class="input-with-icon">
                <input
                  type="text"
                  value=""
                  name="customer[first_name]"
                  id="first_name"
                  class="large"
                  size="30"
                  autocomplete="given-name"
                >
                <button type="button" class="clear-input" data-target="first_name" aria-label="Clear">
                  {% render 'icon', icon: 'close', size: 'extra-small' %}
                </button>
              </div>
            </div>

            <div class="input-row md3-outlined">
              <label for="last_name" class="login">{{ 'customer.register.last_name' | t }}</label>
              <div class="input-with-icon">
                <input
                  type="text"
                  value=""
                  name="customer[last_name]"
                  id="last_name"
                  class="large"
                  size="30"
                  autocomplete="family-name"
                >
                <button type="button" class="clear-input" data-target="last_name" aria-label="Clear">
                  {% render 'icon', icon: 'close', size: 'extra-small' %}
                </button>
              </div>
            </div>

            <div class="input-row md3-outlined">
              <label for="email" class="login">{{ 'customer.register.email' | t }}</label>
              <div class="input-with-icon">
                <input
                  type="email"
                  value=""
                  name="customer[email]"
                  id="email"
                  class="large"
                  size="30"
                  autocomplete="username"
                  spellcheck="false"
                  autocapitalize="off"
                >
                <button type="button" class="clear-input" data-target="email" aria-label="Clear">
                  {% render 'icon', icon: 'close', size: 'extra-small' %}
                </button>
              </div>
              <div class="input-hint error" id="register_email_hint" aria-hidden="true">{{ email_hint_invalid }}</div>
            </div>

            <div class="input-row md3-outlined">
              <div class="text-over-input">
                <label for="password" class="login">{{ 'customer.register.password' | t }}</label>
                <input
                  type="password"
                  value=""
                  name="customer[password]"
                  id="password"
                  class="large password"
                  size="30"
                  autocomplete="new-password"
                >
                <button type="button" class="clear-input" data-target="password" aria-label="Clear">
                  {% render 'icon', icon: 'close', size: 'extra-small' %}
                </button>
                <button
                  type="button"
                  class="password-toggle"
                  data-target="password"
                  aria-pressed="true"
                  aria-label="Show password"
                >
                  {% render 'icon', icon: 'eye', size: 'small' %}
                </button>
              </div>
              <div class="password-strength" aria-hidden="true" data-target="password">
                <span></span><span></span><span></span><span></span>
              </div>
              <div class="password-strength-text" id="password_strength_text" aria-hidden="true"></div>
              <div class="input-hint error" id="password_hint" aria-hidden="true">{{ pwd_hint_minlen }}</div>
            </div>

            {%- render 'consent-module', show_marketing_consent: section.settings.show_marketing_consent -%}

            <div class="lightly-spaced-row-above">
              <button class="btn" type="submit">{{ 'customer.register.submit' | t }}</button>
              <span class="note">
                {{ 'customer.register.have_account' | t }}
                <a href="{{ routes.account_login_url }}" class="underline">{{ 'customer.register.log_in' | t }}</a>
              </span>
            </div>
          {% endform %}
        </div>
      </div>
      <!-- /#create-customer -->
    </div>
  </div>
</div>

<style>
  #shopify-section-{{ section.id }} .page-header .title { margin-bottom: 8px; }
  #shopify-section-{{ section.id }} .page-header .note { color: rgb(var(--text-2)); text-align: center; }
  #shopify-section-{{ section.id }} .page-header .title { text-align: center; }
  #shopify-section-{{ section.id }} .auth-card { max-width: 520px; margin: 0 auto; padding: 0; border: none; border-radius: 12px; box-shadow: none; background: rgb(var(--body-bg-color)); }
  #shopify-section-{{ section.id }} .auth-card .input-row { margin-bottom: 26px; position: relative; }
  #shopify-section-{{ section.id }} .auth-card .input-row label.login { font-weight: 600; position: absolute; left: 16px; top: calc(50% + 1px); transform: translateY(-50%); font-size: 13px; padding: 0 6px; border-radius: 4px; background: transparent; color: #374151; }
  #shopify-section-{{ section.id }} .auth-card .input-row label[for="legal_consent"],
  #shopify-section-{{ section.id }} .auth-card .input-row label[for="accepts_marketing"] { font-weight: 400; font-size: 14px; line-height: 1.6; }
  #shopify-section-{{ section.id }} .auth-card input.large { width: 100%; border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px 12px; transition: border-color .2s ease, box-shadow .2s ease, background-color .2s ease; background-color: #ffffff; }
  #shopify-section-{{ section.id }} .auth-card input.large:focus { outline: 0; border-color: rgb(var(--link-color)); box-shadow: 0 0 0 4px rgba(var(--link-color) / 0.18); }
  #shopify-section-{{ section.id }} .auth-card input.large.input-error { border-color: #a8071a; box-shadow: 0 0 0 4px rgba(168, 7, 26, 0.12); background-color: #fff1f0; }
#shopify-section-{{ section.id }} .auth-card .btn { width: 100%; font-size: 16px; }
  #shopify-section-{{ section.id }} .auth-card button.btn[type="submit"] { background-color: #000; color: #fff; border: 1px solid #000; border-radius: 6px; padding: 12px 18px; font-weight: 600; line-height: 1; min-height: 44px; transition: background-color .15s ease, box-shadow .15s ease, border-color .15s ease, opacity .15s ease; }
  #shopify-section-{{ section.id }} .auth-card button.btn[type="submit"]:hover { background-color: #111; border-color: #111; }
  #shopify-section-{{ section.id }} .auth-card button.btn[type="submit"]:focus-visible { outline: none; box-shadow: 0 0 0 4px rgba(0,0,0,0.18); }
  #shopify-section-{{ section.id }} .auth-card button.btn[type="submit"]:disabled,
  #shopify-section-{{ section.id }} .auth-card button.btn[type="submit"][aria-disabled="true"] { opacity: .6; cursor: not-allowed; }
  #shopify-section-{{ section.id }} .auth-card .input-with-icon { position: relative; }
  #shopify-section-{{ section.id }} .auth-card .text-over-input { position: relative; }
  #shopify-section-{{ section.id }} .auth-card input.password { padding-right: 76px; }
  #shopify-section-{{ section.id }} .auth-card .password-toggle { position: absolute; top: 50%; right: 14px; transform: translateY(-50%); width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; color: #6b7280; }
  #shopify-section-{{ section.id }} .auth-card .password-toggle[aria-pressed="true"]::after { content: ""; position: absolute; width: 20px; border-top: 2px solid currentColor; transform: rotate(-45deg); }
  #shopify-section-{{ section.id }} .text-over-input input.large { padding-left: 12px; }
  #shopify-section-{{ section.id }} .auth-card .clear-input { position: absolute; top: 50%; right: 14px; transform: translateY(-50%); width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; border-radius: 999px; border: 1px solid rgba(0,0,0,0.26); color: rgba(0,0,0,0.68); background: rgb(var(--body-bg-color)); cursor: pointer; opacity: 0; pointer-events: none; transition: opacity .15s ease, background-color .15s ease, border-color .15s ease; }
  #shopify-section-{{ section.id }} .auth-card .clear-input .icon { pointer-events: none; }
  #shopify-section-{{ section.id }} .auth-card .clear-input:hover { background: rgba(0,0,0,0.06); border-color: rgba(0,0,0,0.38); }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined.active .clear-input,
  #shopify-section-{{ section.id }} .auth-card .clear-input.visible { opacity: 1; pointer-events: auto; }
  #shopify-section-{{ section.id }} .auth-card .text-over-input .clear-input { right: 48px; }
  #shopify-section-{{ section.id }} .auth-card .input-with-icon input.large,
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined > input.large { padding-right: 42px; }
#shopify-section-{{ section.id }} .auth-card label.login { display: inline; white-space: normal; }
#shopify-section-{{ section.id }} .auth-card label.login input[type="checkbox"] { margin-right: 8px; margin-top: 2px; }
#shopify-section-{{ section.id }} .auth-card .note a.underline { text-underline-offset: 2px; text-decoration-thickness: 1px; }
#shopify-section-{{ section.id }} .consent-module { margin-top: 20px; }
#shopify-section-{{ section.id }} .consent-module .input-row { margin-bottom: 20px; }
#shopify-section-{{ section.id }} .consent-module .input-row label.login { position: static !important; padding: 0 !important; background: transparent !important; font-size: 14px; }
#shopify-section-{{ section.id }} .auth-card .lightly-spaced-row-above { margin-top: 24px; margin-bottom: 24px; }
#shopify-section-{{ section.id }} .auth-card .lightly-spaced-row-above .note { display: block; margin-top: 12px; }
  #shopify-section-{{ section.id }} .password-strength { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
  #shopify-section-{{ section.id }} .password-strength span { height: 6px; border-radius: 3px; background: #d1d5db; }
  #shopify-section-{{ section.id }} .password-strength[data-level="1"] span:nth-child(-n+1) { background: #fca5a5; }
  #shopify-section-{{ section.id }} .password-strength[data-level="2"] span:nth-child(-n+2) { background: #fdba74; }
  #shopify-section-{{ section.id }} .password-strength[data-level="3"] span:nth-child(-n+3) { background: #fcd34d; }
  #shopify-section-{{ section.id }} .password-strength[data-level="4"] span:nth-child(-n+4) { background: #86efac; }
  #shopify-section-{{ section.id }} .password-strength-text { margin-top: 6px; text-align: right; font-size: 13px; color: #6b7280; }
  #shopify-section-{{ section.id }} .password-strength-text.weak { color: #a8071a; }
  #shopify-section-{{ section.id }} .password-strength-text.fair { color: #b36b00; }
  #shopify-section-{{ section.id }} .password-strength-text.strong { color: #0f766e; }
  #shopify-section-{{ section.id }} .password-strength-text.very-strong { color: #166534; }
  #shopify-section-{{ section.id }} .input-hint { font-size: 13px; margin-top: 6px; }
  #shopify-section-{{ section.id }} .input-hint.error { color: #b00020; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined { margin-bottom: 26px; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined label.login { font-weight: 500; position: absolute; left: 16px; top: calc(50% + 1px); transform: translateY(-50%); font-size: 14px; padding: 0 6px; border-radius: 4px; background: transparent; color: rgba(0,0,0,0.68); z-index: 1; transition: all .15s ease; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined.has-icon label.login { left: 16px; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined.active label.login { top: 0; transform: translateY(-50%); font-size: 12px; background: rgb(var(--body-bg-color)); }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined .input-with-icon input.large,
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined .text-over-input input.large { width: 100%; border: 1px solid #e5e7eb; border-radius: 12px; padding: 12px 12px; background: #ffffff; transition: border-color .2s ease, box-shadow .2s ease, background-color .2s ease; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined.active .input-with-icon input.large,
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined.active .text-over-input input.large { border-color: rgba(0,0,0,0.38); background: transparent; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined .input-with-icon input.large { padding-left: 12px; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined .text-over-input input.large { padding-left: 12px; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined.active input.large:hover { border-color: rgba(0,0,0,0.54); }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined input.large:focus { border-color: rgb(var(--link-color)); box-shadow: 0 0 0 2px rgba(var(--link-color) / 0.18); outline: none; }
  #shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined input.large.input-error { border-color: #b00020; box-shadow: 0 0 0 2px rgba(176,0,32,0.14); background-color: transparent; }
  @media (max-width: 767.98px) { #shopify-section-{{ section.id }} .auth-card { padding: 18px; border-radius: 10px; } }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var passwd = document.getElementById('password');
    var toggle = passwd ? passwd.parentNode.querySelector('.password-toggle[data-target="password"]') : null;
    if (passwd && toggle) {
      toggle.addEventListener('click', function () {
        var visible = passwd.type === 'text';
        passwd.type = visible ? 'password' : 'text';
        toggle.setAttribute('aria-pressed', passwd.type === 'password' ? 'true' : 'false');
      });
    }
    var strength = document.querySelector(
      '#shopify-section-{{ section.id }} .password-strength[data-target="password"]'
    );
    var strengthTextNode = document.getElementById('password_strength_text');
    var hintNode = document.getElementById('password_hint');
    function getLevel(v) {
      var s = String(v || '');
      var len = s.length;
      var classes = 0;
      if (/[a-z]/.test(s)) classes++;
      if (/[A-Z]/.test(s)) classes++;
      if (/\d/.test(s)) classes++;
      if (/[^A-Za-z0-9]/.test(s)) classes++;
      var score = 0;
      if (len >= 8) score++;
      if (len >= 12) score++;
      score += Math.min(classes, 2);
      if (len === 0) return 0;
      return Math.max(1, Math.min(4, score));
    }
    function updateStrength() {
      if (!strength || !passwd) return;
      var lvl = getLevel(passwd.value);
      if (lvl === 0) {
        strength.removeAttribute('data-level');
        if (strengthTextNode) {
          strengthTextNode.textContent = '';
          strengthTextNode.className = 'password-strength-text';
        }
        if (hintNode) {
          hintNode.setAttribute('aria-hidden', 'true');
          hintNode.style.display = 'none';
        }
        passwd.classList.remove('input-error');
        return;
      }
      strength.setAttribute('data-level', String(lvl));
      var txt = '';
      var cls = 'password-strength-text';
      if (lvl === 1) {
        txt = '{{ pwd_strength_weak | escape }}';
        cls += ' weak';
      } else if (lvl === 2) {
        txt = '{{ pwd_strength_fair | escape }}';
        cls += ' fair';
      } else if (lvl === 3) {
        txt = '{{ pwd_strength_strong | escape }}';
        cls += ' strong';
      } else {
        txt = '{{ pwd_strength_very_strong | escape }}';
        cls += ' very-strong';
      }
      if (strengthTextNode) {
        strengthTextNode.textContent = txt;
        strengthTextNode.className = cls;
      }
      var len = passwd.value.length;
      if (len > 0 && len < 8) {
        if (hintNode) {
          hintNode.setAttribute('aria-hidden', 'false');
          hintNode.style.display = 'block';
        }
        passwd.classList.add('input-error');
      } else {
        if (hintNode) {
          hintNode.setAttribute('aria-hidden', 'true');
          hintNode.style.display = 'none';
        }
        passwd.classList.remove('input-error');
      }
    }
    if (passwd) {
      passwd.addEventListener('input', updateStrength);
      updateStrength();
    }
    var regEmail = document.getElementById('email');
    var regEmailHint = document.getElementById('register_email_hint');
    function validateEmail(v) {
      var s = String(v || '').trim();
      if (s.length === 0) return true;
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);
    }
    function updateRegEmail() {
      if (!regEmail || !regEmailHint) return;
      var ok = validateEmail(regEmail.value);
      if (!ok) {
        regEmailHint.setAttribute('aria-hidden', 'false');
        regEmailHint.style.display = 'block';
        regEmail.classList.add('input-error');
      } else {
        regEmailHint.setAttribute('aria-hidden', 'true');
        regEmailHint.style.display = 'none';
        regEmail.classList.remove('input-error');
      }
    }
    if (regEmail) {
      regEmail.addEventListener('input', updateRegEmail);
      regEmail.addEventListener('blur', updateRegEmail);
      updateRegEmail();
    }
    function md3Bind(row) {
      var inp = row.querySelector('input.large');
      if (!inp) return;
      function refresh() {
        var has = !!inp.value && inp.value.length > 0;
        if (has || document.activeElement === inp) row.classList.add('active');
        else row.classList.remove('active');
      }
      inp.addEventListener('focus', refresh);
      inp.addEventListener('blur', refresh);
      inp.addEventListener('input', refresh);
      refresh();
    }
    function bindClear(row) {
      var inp = row.querySelector('input.large');
      var clr = row.querySelector('.clear-input');
      if (!inp || !clr) return;
      function toggle() {
        if (inp.value && inp.value.length > 0) clr.classList.add('visible');
        else clr.classList.remove('visible');
      }
      clr.addEventListener('click', function () {
        inp.value = '';
        inp.dispatchEvent(new Event('input', { bubbles: true }));
        inp.focus();
        toggle();
      });
      inp.addEventListener('input', toggle);
      inp.addEventListener('focus', toggle);
      inp.addEventListener('blur', toggle);
      toggle();
    }
    document
      .querySelectorAll('#shopify-section-{{ section.id }} .auth-card .input-row.md3-outlined')
      .forEach(function (row) {
        md3Bind(row);
        bindClear(row);
      });
  });
</script>

{% schema %}
{
  "name": "Customer register",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_marketing_consent",
      "label": "Show marketing consent",
      "default": false
    }
  ]
}
{% endschema %}
